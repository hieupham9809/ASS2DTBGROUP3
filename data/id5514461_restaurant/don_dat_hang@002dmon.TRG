TYPE=TRIGGERS
triggers='CREATE DEFINER=`root`@`localhost` TRIGGER `trigger_check_statusdonhang_delete` AFTER DELETE ON `don_dat_hang-mon` FOR EACH ROW BEGIN\n	DECLARE done INT DEFAULT FALSE;\n	DECLARE t_ma_dh VARCHAR(45);\n    DECLARE t_ma_item VARCHAR(45);\n    DECLARE trang_thai VARCHAR(45);\n    DECLARE check_status VARCHAR(45);\n    DECLARE dh_cursor CURSOR FOR\n    SELECT DISTINCT `DON_DAT_HANG-MON`.`MA_DON_HANG`\n    FROM `DON_DAT_HANG-MON`;\n    DECLARE item_cursor CURSOR FOR\n    SELECT `DON_DAT_HANG-MON`.`MA_ITEM`\n    FROM `DON_DAT_HANG-MON`\n    WHERE `DON_DAT_HANG-MON`.`MA_DON_HANG` = t_ma_dh;\n    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;\n    OPEN dh_cursor;\n    FETCH dh_cursor INTO t_ma_dh;\n    get_list_dh: LOOP\n    	IF done = TRUE THEN\n        	CLOSE dh_cursor;\n    		LEAVE get_list_dh;\n    	END IF;\n        SET check_status = \'1\';\n    	OPEN item_cursor;\n        FETCH item_cursor INTO t_ma_item;\n        check_item: LOOP\n        	IF done = TRUE THEN\n            	CLOSE item_cursor;\n            	SET done = FALSE;\n    			LEAVE check_item;\n    		END IF;\n            SELECT `DON_DAT_HANG-MON`.`TRANG_THAI` INTO trang_thai\n            FROM `DON_DAT_HANG-MON`\n            WHERE `DON_DAT_HANG-MON`.`MA_DON_HANG` = t_ma_dh AND `DON_DAT_HANG-MON`.`MA_ITEM` = t_ma_item;\n            IF trang_thai = \'Chưa hoàn thành\' THEN\n            	CLOSE item_cursor;\n            	SET check_status = \'0\';\n                LEAVE check_item;\n            END IF;\n            FETCH item_cursor INTO t_ma_item;\n         END LOOP check_item;\n         IF check_status = \'1\' THEN\n         	UPDATE `DON_DAT_HANG`\n            SET `DON_DAT_HANG`.`TINH_TRANG` = \'Đã hoàn thành\'\n            WHERE `DON_DAT_HANG`.`MA_DON_HANG` = t_ma_dh AND `DON_DAT_HANG`.`TINH_TRANG` != \'Đã thanh toán\';\n         ELSE\n         	UPDATE `DON_DAT_HANG`\n            SET `DON_DAT_HANG`.`TINH_TRANG` = \'Chưa hoàn thành\'\n            WHERE `DON_DAT_HANG`.`MA_DON_HANG` = t_ma_dh AND `DON_DAT_HANG`.`TINH_TRANG` != \'Đã thanh toán\';\n         END IF;\n         FETCH dh_cursor INTO t_ma_dh;\n    END LOOP get_list_dh;\nEND' 'CREATE DEFINER=`root`@`localhost` TRIGGER `trigger_check_statusdonhang_insert` AFTER INSERT ON `don_dat_hang-mon` FOR EACH ROW BEGIN\n	DECLARE done INT DEFAULT FALSE;\n	DECLARE t_ma_dh VARCHAR(45);\n    DECLARE t_ma_item VARCHAR(45);\n    DECLARE trang_thai VARCHAR(45);\n    DECLARE check_status VARCHAR(45);\n    DECLARE dh_cursor CURSOR FOR\n    SELECT DISTINCT `DON_DAT_HANG-MON`.`MA_DON_HANG`\n    FROM `DON_DAT_HANG-MON`;\n    DECLARE item_cursor CURSOR FOR\n    SELECT `DON_DAT_HANG-MON`.`MA_ITEM`\n    FROM `DON_DAT_HANG-MON`\n    WHERE `DON_DAT_HANG-MON`.`MA_DON_HANG` = t_ma_dh;\n    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;\n    OPEN dh_cursor;\n    FETCH dh_cursor INTO t_ma_dh;\n    get_list_dh: LOOP\n    	IF done = TRUE THEN\n        	CLOSE dh_cursor;\n    		LEAVE get_list_dh;\n    	END IF;\n        SET check_status = \'1\';\n    	OPEN item_cursor;\n        FETCH item_cursor INTO t_ma_item;\n        check_item: LOOP\n        	IF done = TRUE THEN\n            	CLOSE item_cursor;\n            	SET done = FALSE;\n    			LEAVE check_item;\n    		END IF;\n            SELECT `DON_DAT_HANG-MON`.`TRANG_THAI` INTO trang_thai\n            FROM `DON_DAT_HANG-MON`\n            WHERE `DON_DAT_HANG-MON`.`MA_DON_HANG` = t_ma_dh AND `DON_DAT_HANG-MON`.`MA_ITEM` = t_ma_item;\n            IF trang_thai = \'Chưa hoàn thành\' THEN\n            	CLOSE item_cursor;\n            	SET check_status = \'0\';\n                LEAVE check_item;\n            END IF;\n            FETCH item_cursor INTO t_ma_item;\n         END LOOP check_item;\n         IF check_status = \'1\' THEN\n         	UPDATE `DON_DAT_HANG`\n            SET `DON_DAT_HANG`.`TINH_TRANG` = \'Đã hoàn thành\'\n            WHERE `DON_DAT_HANG`.`MA_DON_HANG` = t_ma_dh AND `DON_DAT_HANG`.`TINH_TRANG` != \'Đã thanh toán\';\n         ELSE\n         	UPDATE `DON_DAT_HANG`\n            SET `DON_DAT_HANG`.`TINH_TRANG` = \'Chưa hoàn thành\'\n            WHERE `DON_DAT_HANG`.`MA_DON_HANG` = t_ma_dh AND `DON_DAT_HANG`.`TINH_TRANG` != \'Đã thanh toán\';\n         END IF;\n         FETCH dh_cursor INTO t_ma_dh;\n    END LOOP get_list_dh;\nEND' 'CREATE DEFINER=`root`@`localhost` TRIGGER `trigger_check_statusdonhang` AFTER UPDATE ON `don_dat_hang-mon` FOR EACH ROW BEGIN\n	DECLARE done INT DEFAULT FALSE;\n	DECLARE t_ma_dh VARCHAR(45);\n    DECLARE t_ma_item VARCHAR(45);\n    DECLARE trang_thai VARCHAR(45);\n    DECLARE check_status VARCHAR(45);\n    DECLARE dh_cursor CURSOR FOR\n    SELECT DISTINCT `DON_DAT_HANG-MON`.`MA_DON_HANG`\n    FROM `DON_DAT_HANG-MON`;\n    DECLARE item_cursor CURSOR FOR\n    SELECT `DON_DAT_HANG-MON`.`MA_ITEM`\n    FROM `DON_DAT_HANG-MON`\n    WHERE `DON_DAT_HANG-MON`.`MA_DON_HANG` = t_ma_dh;\n    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;\n    OPEN dh_cursor;\n    FETCH dh_cursor INTO t_ma_dh;\n    get_list_dh: LOOP\n    	IF done = TRUE THEN\n        	CLOSE dh_cursor;\n    		LEAVE get_list_dh;\n    	END IF;\n        SET check_status = \'1\';\n    	OPEN item_cursor;\n        FETCH item_cursor INTO t_ma_item;\n        check_item: LOOP\n        	IF done = TRUE THEN\n            	CLOSE item_cursor;\n            	SET done = FALSE;\n    			LEAVE check_item;\n    		END IF;\n            SELECT `DON_DAT_HANG-MON`.`TRANG_THAI` INTO trang_thai\n            FROM `DON_DAT_HANG-MON`\n            WHERE `DON_DAT_HANG-MON`.`MA_DON_HANG` = t_ma_dh AND `DON_DAT_HANG-MON`.`MA_ITEM` = t_ma_item;\n            IF trang_thai = \'Chưa hoàn thành\' THEN\n            	CLOSE item_cursor;\n            	SET check_status = \'0\';\n                LEAVE check_item;\n            END IF;\n            FETCH item_cursor INTO t_ma_item;\n         END LOOP check_item;\n         IF check_status = \'1\' THEN\n         	UPDATE `DON_DAT_HANG`\n            SET `DON_DAT_HANG`.`TINH_TRANG` = \'Đã hoàn thành\'\n            WHERE `DON_DAT_HANG`.`MA_DON_HANG` = t_ma_dh AND `DON_DAT_HANG`.`TINH_TRANG` != \'Đã thanh toán\';\n         ELSE\n         	UPDATE `DON_DAT_HANG`\n            SET `DON_DAT_HANG`.`TINH_TRANG` = \'Chưa hoàn thành\'\n            WHERE `DON_DAT_HANG`.`MA_DON_HANG` = t_ma_dh AND `DON_DAT_HANG`.`TINH_TRANG` != \'Đã thanh toán\';\n         END IF;\n         FETCH dh_cursor INTO t_ma_dh;\n    END LOOP get_list_dh;\nEND'
sql_modes=1342177280 1342177280 1342177280
definers='root@localhost' 'root@localhost' 'root@localhost'
client_cs_names='utf8mb4' 'utf8mb4' 'utf8mb4'
connection_cl_names='utf8mb4_unicode_ci' 'utf8mb4_unicode_ci' 'utf8mb4_unicode_ci'
db_cl_names='utf8_unicode_ci' 'utf8_unicode_ci' 'utf8_unicode_ci'
